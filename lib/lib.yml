stages:
- test

variables:
  BUILD_VERSION: v0.1.0

test:builtins:
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  stage: test
  image: registry.gitlab.com/pep10/pepsuite/develop:${BUILD_VERSION}
  needs: []
  before_script:
    - cd lib/builtins
  script:
    - source /emsdk/emsdk_env.sh
    - export CXX=$(which clang++)
    - export C=$(which clang)
    - (cd gen && python3 gen.py)
    - mkdir build && cd build
    - cmake ../
    - make -j4 && make test